# 単体テスト 記述ルール

`lib/bright` 以下のコードに対するテストコードを「単体テスト」と呼ぶ。

## 共通

- ホワイトボックステスト
- 原則、すべてのパブリック関数（ `def` で定義した関数）に対し、テストを記述
  - プライベート関数（ `defp` で定義した関数）は、テストの記述は不要
- テストデータの定義・生成には [ex_machina](https://hexdocs.pm/ex_machina) を使用
  - テストデータとして任意の値を入れたい場合、可能な限り [faker](https://hexdocs.pm/faker) を使用
  - `mix phx.gen.***` で生成される `test/support/fixtures` 以下のモジュールは使用せず削除すること

## スキーマモジュール

`use Ecto.Schema` を記述しているモジュールを「スキーマモジュール」と呼ぶ。

- `Ecto.Changeset` を返すだけの関数は、テストの記述は不要
- その他、定義した関数についてはテストを記述

## コンテキストモジュール

DBのCRUD操作を行う関数を定義しているモジュールを「コンテキストモジュール」と呼ぶ。

- 正常系（HTTPでの2xxに相当）・準正常系（HTTPでの4xxに相当）のテストを記述
- DBの異常系（HTTPでの5xxに相当）は、テストの記述は不要
  - DBに障害が起きているということはシステム全体がダウンしていることと同義のため、個々の関数をテストするメリットが少ない

## Phoenixプロジェクト作成時点で存在するファイル

以下のファイルは、テストの記述は不要とする。

- `application.ex`
- `mailer.ex`
- `repo.ex`
